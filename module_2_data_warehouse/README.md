# Module 2 â€“ Data Warehouse & Analytics

## ðŸ“Œ Module Overview
In this module, a **Data Warehouse** was designed and implemented for the
e-commerce company **SoftCart.com** using **PostgreSQL**.

The module focuses on dimensional modeling, data loading, and analytical
queries such as **GROUPING SETS**, **ROLLUP**, **CUBE**, and
**Materialized Views (MQTs)** to support business reporting and analytics.

---

## ðŸŽ¯ Learning Objectives
- Design a Data Warehouse using a star schema
- Create dimension and fact tables
- Load data into a Data Warehouse
- Write advanced aggregation queries
- Create and query Materialized Views

---

## ðŸ“ Module Structure
```
module_2_data_warehouse/
â”œâ”€â”€ README.md                       â† Module documentation and explanation
â”‚
â”œâ”€â”€ ddl/
â”‚   â”œâ”€â”€ create_schema.sql           â† Creates defines dimension & fact tables
â”‚   â””â”€â”€ erd_create_script.sql       â† auto-generated pgAdmin ERD script
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ DimDate.csv                 â† Date dimension source data
â”‚   â”œâ”€â”€ DimCategory.csv             â† Product category dimension data
â”‚   â”œâ”€â”€ DimCountry.csv              â† Country dimension data
â”‚   â””â”€â”€ FactSales.csv               â† Fact table source data (sales transactions)
â”‚
â”œâ”€â”€ dml/
â”‚   â””â”€â”€ load_data.sql               â† COPY commands for loading CSV data into PostgreSQL tables
â”‚
â”œâ”€â”€ analytics/
â”‚   â”œâ”€â”€ grouping_sets.sql           â† Aggregations using GROUPING SETS
â”‚   â”œâ”€â”€ rollup.sql                  â† Hierarchical aggregations using ROLLUP
â”‚   â”œâ”€â”€ cube.sql                    â† Multidimensional aggregations using CUBE
â”‚   â””â”€â”€ materialized_view.sql       â† Materialized View for total sales per country
â”‚
â””â”€â”€ screenshots/
    â”œâ”€â”€ dimtablesERD.png            â† ERD view of dimension tables
    â”œâ”€â”€ FactSalesERD.png            â† ERD view of FactSales table
    â”œâ”€â”€ Relationships.png           â† ERD showing star schema relationships
    â”œâ”€â”€ DimDate.png                 â† Data validation for DimDate
    â”œâ”€â”€ DimCategory.png             â† Data validation for DimCategory
    â”œâ”€â”€ DimCountry.png              â† Data validation for DimCountry
    â”œâ”€â”€ FactSales.png               â† Data validation for FactSales
    â”œâ”€â”€ groupingsets.png            â† GROUPING SETS query results
    â”œâ”€â”€ rollup.png                  â† ROLLUP query results
    â”œâ”€â”€ cube.png                    â† CUBE query results
    â””â”€â”€ mqt.png                     â† Materialized View query results

```
> Note: The file `erd_create_script.sql` was auto-generated by the pgAdmin ERD tool
> during the schema design phase.  

---

## ðŸ›  Tools & Technologies
- PostgreSQL
- pgAdmin (ERD Designer & Query Tool)
- IBM Skills Network Labs (SN Labs)
- Docker-based PostgreSQL environment

---

## ðŸ§± Data Warehouse Design

### Star Schema
The Data Warehouse follows a **star schema** design consisting of:

#### Dimension Tables
- **DimDate** â€“ date attributes (year, month, weekday, etc.)
- **DimCategory** â€“ product categories
- **DimCountry** â€“ customer countries


#### Fact Table
- **FactSales** â€“ transactional sales measures (amount, quantity)

ðŸ“¸ ERD screenshots:
- `dimtables.png`
- `FactSales.png`
- `Relationships.png`

---

## ðŸ—„ Schema Creation
A dedicated schema named **staging** was created to host the Data Warehouse objects.
> Note: Although the staging schema was created, tables were created in the
> default `public` schema as required by the lab environment.
DDL scripts:
- [`create_schema.sql`](ddl/create_schema.sql)
- [`erd_create_script.sql`](ddl/erd_create_script.sql)

---

## ðŸ“¥ Data Loading
Data was loaded into the dimension and fact tables from CSV files using pgAdmin.
The data loading process uses PostgreSQL COPY commands executed via pgAdmin.
Data was loaded into the DimDate, DimCategory, DimCountry, and FactSales tables.
CSV files were loaded via pgAdmin using COPY commands
from the `/var/lib/pgadmin/` directory as required by SN Labs.

 Loaded datasets:
- DimDate.csv
- DimCategory.csv
- DimCountry.csv
- FactSales.csv

Each table was validated by querying the first 5 rows.

ðŸ“¸ Validation screenshots:
- DimDate.png
- DimCategory.png
- DimCountry.png
- FactSales.png

---

## ðŸ“Š Analytical Queries
***GROUPING SETS***
Aggregated total sales by country and category.
Query:
```sql
SELECT c.country, cat.category, SUM(f.amount) AS totalsales
FROM public."FactSales" f
JOIN public."DimCountry" c ON f.countryid = c.countryid
JOIN public."DimCategory" cat ON f.categoryid = cat.categoryid
GROUP BY GROUPING SETS
(
    (c.country, cat.category),
    (c.country),
    (cat.category),
    ()
);
```
ðŸ“¸ Screenshot:
[`groupingsets.png`](`groupingsets.png`)

***ROLLUP***
Aggregated yearly sales by country.
ðŸ“¸ Screenshot:
[`rollup.png`](`rollup.png`) 

***CUBE***
Calculated average sales across all combinations of year and country.
ðŸ“¸ Screenshot:
[`cube.png`](`cube.png`) 

***ðŸ“¦ Materialized View (MQT-style optimization)***
A Materialized View was created to store total sales per country.
```sql
CREATE MATERIALIZED VIEW total_sales_per_country AS
SELECT c.country, SUM(f.amount) AS total_sales
FROM public."FactSales" f
JOIN public."DimCountry" c
    ON f.countryid = c.countryid
GROUP BY c.country;
```
ðŸ“¸ Screenshot:
[`mqt.png`](`mqt.png`) 

---

## â–¶ Execution Order
1. Run DDL scripts from `ddl/`
2. Load CSV files using `dml/load_data.sql`
3. Execute analytical queries from `analytics/`

---

## âœ… Module Outcome
- Data Warehouse successfully designed and implemented
- Data loaded into dimension and fact tables
- Advanced analytical queries executed
- Materialized View created for performance optimization

This module demonstrates practical Data Warehousing and Analytics skills using PostgreSQL in a production-like environment.

